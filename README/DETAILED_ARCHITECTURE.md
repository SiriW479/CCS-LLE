# CCS-LLE è¯¦ç»†æ¶æ„å¯¹ç…§è¡¨

## è®ºæ–‡ä¸‰å¤§æ¨¡å—ä¸ä»£ç æ˜ å°„

### ğŸ“ å¿«é€ŸæŸ¥è¯¢è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®ºæ–‡æ¨¡å—         â”‚ Pythonæ–‡ä»¶                â”‚ æ ¸å¿ƒç±»                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RefIE            â”‚ ref_exposure_combine_clean â”‚ DecomYUVScaleNetSplit    â”‚
â”‚ (äº®åº¦å¢å¼º)       â”‚                           â”‚ ScaleYUVBlock            â”‚
â”‚                  â”‚                           â”‚ SingleDecomNetSplit      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RefAT            â”‚ test_flow_sample_refine    â”‚ DecomNet_attention       â”‚
â”‚ (å¤–è§‚è¿ç§»)       â”‚ _res_clean.py              â”‚ + PWCDCNet (PWCNet.py)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RefSR            â”‚ ref_SR_deshape_clean.py    â”‚ HDRNetwoBN               â”‚
â”‚ (è‰²åº¦è¶…åˆ†)       â”‚                           â”‚ (æ”¹è¿›çš„HDRNetæ¶æ„)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¯¦ç»†æ¨¡å—å®ç°ç»†èŠ‚

### ğŸ”µ RefIE (Reference-based Illumination Enhancement)

**æ–‡ä»¶**: `ref_exposure_combine_clean.py`

**å·¥ä½œæµç¨‹**:
```
è¾“å…¥ï¼šLSRå½©è‰²å›¾ (B, 3, H, W) + HSRå•è‰²Yé€šé“ (B, 1, H, W)
  â†“
[1] å…¨å±€äº®åº¦å°ºåº¦ä¼°è®¡ (ScaleYUVBlock)
  â”œâ”€ æå– YUV ä¸­çš„ Y å’Œ ref_Y
  â”œâ”€ æ‹¼æ¥ä¸º (B, 2, H, W)
  â”œâ”€ 9Ã—9 Conv æå–åˆå§‹ç‰¹å¾ â†’ 64é€šé“
  â”œâ”€ MaxPool (3Ã—3 stride 4) / AvgPool è·å–å¤šå±‚çº§ç‰¹å¾
  â”œâ”€ çº§è”èåˆï¼šConv(128â†’64) â†’ Conv(128â†’64) â†’ Conv(64â†’3)
  â””â”€ è¾“å‡ºå…¨å±€å°ºåº¦å› å­ S (B, 3, H, W) âœ… Patch-wise!
  â†“
[2] åƒç´ çº§å¢å¼º (SingleDecomNetSplit)
  â”œâ”€ å°† LSR Ã— S è·å¾—åˆæ­¥å¢å¼º
  â”œâ”€ 5å±‚ BasicBlock (ç¾¤å·ç§¯ groups=2)
  â”œâ”€ æ®‹å·®å­¦ä¹ ï¼šy = tanh(conv) + x
  â””â”€ è¾“å‡ºå¢å¼ºå›¾åƒ (B, 3, H, W)
  â†“
è¾“å‡ºï¼šå¢å¼ºåçš„YUVå›¾åƒ
```

**å…³é”®å‚æ•°**:
- Conv1 kernel: **9Ã—9** (æ„Ÿå—é‡48Ã—48)
- Pooling: **3Ã—3 stride 4** (æ„Ÿå—é‡ Patch çº§åˆ«)
- ç½‘ç»œæ·±åº¦: **5å±‚ BasicBlock**

**Why Patch-wise?**
```
å…¨å±€å¼ºåº¦ä¼°è®¡éœ€è¦å¤§æ„Ÿå—é‡æ¥æ•è·å…‰ç…§åˆ†å¸ƒ
MaxPool + AvgPool çš„ç»„åˆå¯ä»¥åŒæ—¶ä¿ç•™
æœ€å¤§å€¼å’Œå¹³å‡å€¼ä¿¡æ¯ï¼Œç”¨äºå¥å£®çš„å°ºåº¦ä¼°è®¡
```

---

### ğŸŸ  RefAT (Reference-based Appearance Transfer)

**æ–‡ä»¶**: `test_flow_sample_refine_res_clean.py`

**å·¥ä½œæµç¨‹**:
```
è¾“å…¥1: LSRå½©è‰²å›¾ (B, 3, H, W)
è¾“å…¥2: HSRå•è‰²å›¾ (B, 1, H, W) [ä½œä¸ºå‚è€ƒ]

  â†“
[1] å…‰æµä¼°è®¡ (PWCDCNet from PWCNet.py)
  â”œâ”€ è¾“å…¥: [HSRå•è‰²æ‰©å±•åˆ°3ch, LSRå•è‰²]
  â”œâ”€ è¾“å‡º: å…‰æµ (B, 2, H_LSR, W_LSR)
  â””â”€ ç”¨äºå¯¹é½: HSR_color â†’ LSRåˆ†è¾¨ç‡
  â†“
[2] å›¾åƒå˜å½¢ (warp å‡½æ•°)
  â”œâ”€ è¾“å…¥: HSRå½©è‰²å›¾ + å…‰æµ
  â”œâ”€ ä½¿ç”¨ grid_sample è¿›è¡ŒåŒçº¿æ€§æ’å€¼
  â”œâ”€ è¾“å‡º: å˜å½¢åçš„å‚è€ƒå›¾ warp_x (B, 3, H, W)
  â””â”€ æœ‰æ•ˆæ©ç  mask (B, 3, H, W) [è¾¹ç•Œå¤„ç†]
  â†“
[3] å¤–è§‚è¿ç§»èåˆ (DecomNet_attention)
  â”œâ”€ è¾“å…¥æ‹¼æ¥: [LSRå½©è‰², warp_x, LSRå•è‰²] = (B, 7, H, W)
  â”‚   â””â”€ LSRå½©è‰²(3) + å˜å½¢å‚è€ƒ(3) + LSR Y(1)
  â”œâ”€ 9Ã—9 Conv åˆå§‹ç‰¹å¾æå– â†’ 64é€šé“
  â”œâ”€ 5å±‚ BasicBlock ç‰¹å¾èåˆ
  â”œâ”€ 3Ã—3 Conv è¾“å‡º 6é€šé“
  â”‚   â””â”€ å‰3é€šé“: èåˆåå›¾åƒ
  â”‚   â””â”€ å3é€šé“: èåˆæ©ç 
  â”œâ”€ Sigmoid å½’ä¸€åŒ–æ©ç  âˆˆ [0,1]
  â””â”€ èåˆ: out = img Ã— mask + warp_x Ã— (1-mask)
  â†“
è¾“å‡º: èåˆåçš„å½©è‰²å›¾åƒ (å¤–è§‚å·²è¿ç§»)
```

**æ©ç ç”Ÿæˆé€»è¾‘**:
```python
def forward(..., strong_mask=False):
    ...
    img2, mask = out.clone()[:,0:3,:,:], out.clone()[:,3:,:,:]
    
    # æ ‡å‡†æ©ç 
    if strong_mask:
        # å¢å¼ºæ©ç å¯¹æ¯”åº¦
        mask = 1/(1+exp(-10*(mask-0.5)))  # å½¢å¦‚ Sigmoid çš„å¢å¼º
    
    # èåˆï¼šæ©ç æƒé‡èåˆ
    out_refine = img2 * mask + warp_x * (1 - mask)
```

**å…³é”®ç‚¹**:
- âœ… **å…‰æµå¯¹é½æ˜¯å…³é”®**ï¼šHSR â†’ LSR é€šè¿‡PWCNetè®¡ç®—å…‰æµ
- âœ… **æ³¨æ„åŠ›æ©ç å­¦ä¹ **ï¼šç½‘ç»œè‡ªåŠ¨å­¦ä¹ èåˆæƒé‡
- âœ… **7é€šé“è¾“å…¥**ï¼šåŒ…å« LSRå•è‰²ä½œä¸ºè¾…åŠ©å¼•å¯¼

---

### ğŸŸ£ RefSR (Reference-based Super-Resolution)

**æ–‡ä»¶**: `ref_SR_deshape_clean.py`

**æ¶æ„**: æ”¹è¿›çš„ HDRNet (Gharbi et al., 2017)

**å·¥ä½œæµç¨‹**:
```
è¾“å…¥1: ä½åˆ†è¾¨ç‡å½©è‰²å›¾ (B, 3, H, W)      [480Ã—640]
è¾“å…¥2: é«˜åˆ†è¾¨ç‡Yé€šé“ (B, 1, H_h, W_h)  [960Ã—1280]

  â†“ HDRNetwoBN.forward(low_res_input, full_res_input)

[1] ç‰¹å¾æå– (Splat åˆ†æ”¯)
  â”œâ”€ 4å±‚å·ç§¯é€å±‚ä¸‹é‡‡æ ·
  â”‚  â€¢ Layer0: 3 â†’ 8ch, stride 2
  â”‚  â€¢ Layer1: 8 â†’ 16ch, stride 2
  â”‚  â€¢ Layer2: 16 â†’ 32ch, stride 2
  â”‚  â€¢ Layer3: 32 â†’ 64ch, stride 2
  â”œâ”€ è¾“å‡ºåˆ†è¾¨ç‡: 1/16 = 30Ã—40
  â””â”€ è¾“å‡º: splat_fea (B, 64, 30, 40)
  â†“
[2] å…¨å±€ä¸Šä¸‹æ–‡ (Global Branch)
  â”œâ”€ global_brach() æ¨¡å—
  â”œâ”€ [å¤šå±‚çº§è‡ªé€‚åº”å¹³å‡æ± åŒ–] âœ… å…³é”®ï¼
  â”‚  â€¢ a0 = AdaptiveAvgPool2d(1Ã—1) â†’ (B, 64, 1, 1)
  â”‚  â€¢ x = Conv(stride 2) â†’ (B, 128, 15, 20)
  â”‚  â€¢ a1 = AdaptiveAvgPool2d(1Ã—1) â†’ (B, 128, 1, 1)
  â”‚  â€¢ x = Conv(stride 2) â†’ (B, 256, 7, 10)
  â”‚  â€¢ a2 = AdaptiveAvgPool2d(1Ã—1) â†’ (B, 256, 1, 1)
  â”œâ”€ çº§è”èåˆ: [a0, a1, a2] (B, 448, 1, 1)
  â”œâ”€ Conv é€æ­¥èåˆ: 448 â†’ 256 â†’ 128 â†’ 64
  â””â”€ å…¨å±€ç‰¹å¾ (B, 64, 1, 1)
  â†“
[3] ç‰¹å¾èåˆ
  â”œâ”€ fused = global_feature(1,1) + local_feature(30,40)
  â”‚  â””â”€ è‡ªåŠ¨å¹¿æ’­: (B, 64, 1, 1) + (B, 64, 30, 40)
  â””â”€ è¾“å‡º: fused (B, 64, 30, 40)
  â†“
[4] åŒè¾¹ç½‘æ ¼ç”Ÿæˆ âœ… HDRNet æ ¸å¿ƒï¼
  â”œâ”€ self.linear: Conv2d(64, 96)
  â”‚  â””â”€ 96 = 12é€šé“ Ã— 8å€¼ (bilateral grid)
  â”œâ”€ å½¢çŠ¶è½¬æ¢: (B, 96, 30, 40) â†’ (B, 12, 8, 30, 40)
  â”‚  â””â”€ 12é€šé“å¯¹åº” [Yåç§», Uåç§»Ã—3, Våç§»Ã—3, Yç¼©æ”¾, Uç¼©æ”¾, Vç¼©æ”¾]
  â””â”€ åŒè¾¹ç½‘æ ¼å°±ç»ª
  â†“
[5] å¼•å¯¼å›¾ç”Ÿæˆ (Guide2 + Slice)
  â”œâ”€ Guide2 (PointwiseNN æ¨¡å¼)
  â”‚  â”œâ”€ è¾“å…¥: é«˜åˆ†è¾¨ç‡Y (B, 1, 960, 1280)
  â”‚  â”œâ”€ Conv1(1â†’16, k=3) + ReLU
  â”‚  â””â”€ Conv2(16â†’1, k=1) + Tanh â†’ å¼•å¯¼å›¾ (B, 1, 960, 1280)
  â”‚
  â”œâ”€ Slice (grid_sample é‡‡æ ·)
  â”‚  â”œâ”€ åˆ›å»ºç©ºé—´åæ ‡ç½‘æ ¼ (xx, yy)
  â”‚  â”œâ”€ æ‹¼æ¥: [grid(2ch), guidemap(1ch)] = 3ch
  â”‚  â”œâ”€ ä»åŒè¾¹ç½‘æ ¼é‡‡æ ·ç³»æ•°
  â”‚  â””â”€ ç³»æ•° coeff (B, 12, 960, 1280)
  â†“
[6] å˜æ¢åº”ç”¨ (Transform)
  â”œâ”€ Y = full_res_input Ã— coeff[3] + sum(coeff[0:3])
  â”œâ”€ U = full_res_input Ã— coeff[7] + sum(coeff[4:7])
  â”œâ”€ V = full_res_input Ã— coeff[11] + sum(coeff[8:11])
  â””â”€ bufferYUV (B, 3, 960, 1280)
  â†“
[7] è‰²åº¦å¾®è°ƒ (adjustChrome)
  â”œâ”€ adjustChromeU å’Œ adjustChromeV
  â”œâ”€ è¾“å…¥: å•é€šé“ U æˆ– V
  â”œâ”€ Conv1(1â†’16, k=1) + ReLU
  â”œâ”€ Conv2(16â†’1, k=1) + Tanh
  â”œâ”€ è¾“å‡º: å¾®è°ƒå€¼
  â””â”€ æœ€ç»ˆ: U' = adjustChromeU(...) + fake_res_input[:, 1]
  â†“
è¾“å‡º: æœ€ç»ˆ YUV (B, 3, 960, 1280) âœ… é«˜åˆ†è¾¨ç‡å½©è‰²
```

**HDRNet æ”¹è¿›è¦ç‚¹**:

| æ ‡å‡†HDRNet | CCS-LLE HDRNetwoBN |
|-----------|-------------------|
| åŒè¾¹ç½‘æ ¼ç»´åº¦ | 96ç»´ (12Ã—8) â†’ **æ›´ç»†è‡´** |
| å…¨å±€åˆ†æ”¯ | âŒ æ—  | âœ… æœ‰ (å¤šå±‚çº§AAP) |
| è‰²åº¦å¤„ç† | âŒ ç®€å•çº¿æ€§ | âœ… ä¸“ç”¨å¾®è°ƒç½‘ç»œ |
| å¼•å¯¼æ–¹å¼ | RGBå›¾åƒ | **ä»…ç”¨Yé€šé“** |
| åº”ç”¨æ–¹å¼ | çº¹ç† + è‰²å½© | **Y+U/Våˆ†ç¦»** |

---

## ğŸ”´ å…‰æµå¯¹é½è¯¦è§£ (PWCNet.py)

**ä¸¤ä¸ªå®ç°ç‰ˆæœ¬**:

### ç‰ˆæœ¬1: GPUç‰ˆæœ¬ (PWCDCNet)
```python
class PWCDCNet(nn.Module):
    def __init__(self, input_channel=3, md=4):
        # md: æœ€å¤§ä½ç§» = 4åƒç´ 
        # ç›¸å…³æ€§ç»´åº¦ = (2*4+1)Â² = 81
        
        # ç‰¹å¾æå–: 6å±‚ä¸‹é‡‡æ ·é‡‘å­—å¡”
        self.conv1a, conv1aa, conv1b  # å±‚1: stride 2 â†’ 1/2
        self.conv2a, conv2aa, conv2b  # å±‚2: stride 2 â†’ 1/4
        self.conv3a, conv3aa, conv3b  # å±‚3: stride 2 â†’ 1/8
        self.conv4a, conv4aa, conv4b  # å±‚4: stride 2 â†’ 1/16
        self.conv5a, conv5aa, conv5b  # å±‚5: stride 2 â†’ 1/32
        self.conv6a, conv6aa, conv6b  # å±‚6: stride 2 â†’ 1/64
        
        # CUDAç›¸å…³æ€§å±‚
        self.corr = Correlation(pad_size=md, kernel_size=1,
                               max_displacement=md, stride1=1, stride2=1)
    
    def forward(self, x):
        # x = [image1_3ch | image2_3ch] 6é€šé“æ‹¼æ¥
        C_channel = x.shape[1] // 2
        im1, im2 = x[:, :C_channel], x[:, C_channel:]
        
        # ç‰¹å¾æå–
        c1_1, c1_2 = self.conv1b(...), ...
        c2_1, c2_2 = self.conv2b(...), ...
        ...
        c6_1, c6_2 = self.conv6b(...), ...
        
        # ä»ç²—åˆ°ç»†çš„æµä¼°è®¡ (6â†’2)
        # ç¬¬6å±‚: æœ€ç²—ï¼Œ1/64 åˆ†è¾¨ç‡
        corr6 = self.corr(c6_1, c6_2)  # (B, 81, H/64, W/64)
        # â†’ 5å±‚å·ç§¯ â†’ flow6 (B, 2, H/64, W/64)
        
        # ä¸Šé‡‡æ · + ç¬¬5å±‚ç»†åŒ–
        warp5 = warp(c5_2, up_flow6 * 0.625)
        corr5 = self.corr(c5_1, warp5)
        # ...
        
        # æœ€ç»ˆ: ç¬¬2å±‚è¾“å‡º
        # ä½¿ç”¨7å±‚è†¨èƒ€å·ç§¯ç²¾åŒ–å…‰æµ
        # dc_conv1-7: dilation [1, 2, 4, 8, 16, 1]
        flow2 += self.dc_conv7(self.dc_conv6(...))
        
        return flow2  # (B, 2, H/4, W/4)
```

### ç‰ˆæœ¬2: CPUç‰ˆæœ¬ (PWCDCNetCPU)
```python
class PWCDCNetCPU(nn.Module):
    def __init__(self, input_channel=3, md=4):
        # ç»“æ„å®Œå…¨ç›¸åŒï¼Œä»…ç›¸å…³æ€§å±‚ä¸åŒ
        self.corr = Correlation_CPU(kernel_size=2*md+1)
        # CPUç‰ˆæœ¬ä½¿ç”¨ kernel_size=9 (2*4+1)
        # è€Œä¸æ˜¯ pad_size=4
```

**è‡ªåŠ¨é™çº§æœºåˆ¶** (test-3ref-clean.py):
```python
from test_device import is_gpu_supported_by_pytorch13

supported, message = is_gpu_supported_by_pytorch13()
if not supported:
    # ä½¿ç”¨ CPU ç‰ˆæœ¬
    flow_net = PWCDCNetCPU()
else:
    # ä½¿ç”¨ GPU ç‰ˆæœ¬
    flow_net = PWCDCNet()
```

---

## ğŸ“Š æ•°æ®æµå‘æ€»å›¾

```
çœŸå®æ•è·åœºæ™¯
â”œâ”€ ä½æ›å…‰å½©è‰²ç›¸æœº (480Ã—640, RGB)
â””â”€ é«˜æ›å…‰å•è‰²ç›¸æœº (960Ã—1280, å•è‰²)

                â†“ [æ•°æ®åŠ è½½ä¸é¢„å¤„ç†]
        
è¾“å…¥å¼ é‡ï¼š
â”œâ”€ color: (B, 3, 480, 640)  [LSR RGB]
â”œâ”€ mono:  (B, 1, 480, 640)  [LSR å•è‰²]
â””â”€ label: (B, 1, 960, 1280) [HSR å•è‰²çœŸå€¼]

                â†“ [rgb2yuv è½¬æ¢]
                
â”œâ”€ color_yuv: (B, 3, 480, 640)
â””â”€ mono_yuv:  (B, 1, 480, 640)

                â†“ [RefIE: äº®åº¦å¢å¼º]
    DecomYUVScaleNetSplit(color_yuv, mono_yuv)
                â†“
â”œâ”€ enhanced_yuv: (B, 3, 480, 640)
â””â”€ scale_factor: (B, 3, 480, 640)

                â†“ [PWCNet: å…‰æµè®¡ç®—]
    PWCDCNet([mono_upsample, mono_yuv])
                â†“
    optical_flow: (B, 2, 480, 640)

                â†“ [Image Warping]
    warp(label_extended, optical_flow)
                â†“
    warped_ref: (B, 3, 480, 640)

                â†“ [RefAT: å¤–è§‚è¿ç§»]
    DecomNet_attention(enhanced_yuv, warped_ref, mono_yuv)
                â†“
    transferred_yuv: (B, 3, 480, 640)

                â†“ [RefSR: è‰²åº¦è¶…åˆ†]
    HDRNetwoBN(transferred_yuv, label_yuv)
                â†“
    final_sr_yuv: (B, 3, 960, 1280)

                â†“ [yuv2rgb è½¬æ¢]
                
    output_rgb: (B, 3, 960, 1280) âœ… æœ€ç»ˆç»“æœï¼
```

---

## ğŸ“ å…³é”®è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆ YUV è€Œä¸æ˜¯ RGBï¼Ÿ
```
åŸå› ï¼š
1. Yé€šé“æºå¸¦ä¸»è¦ä¿¡æ¯ï¼Œå¯ç‹¬ç«‹å¤„ç†
2. äº®åº¦å¢å¼ºä½œç”¨åœ¨Yï¼Œé¢œè‰²ä¸å˜
3. å‚è€ƒå•è‰²å›¾çš„Yç›´æ¥å¯ç”¨
4. è¶…åˆ†è¾¨ç‡ï¼šYé«˜åˆ†â†’U/Vç”¨å®ƒå¼•å¯¼
```

### ä¸ºä»€ä¹ˆç”¨ Patch-wise ç‰¹å¾ï¼Ÿ
```
åŸå› ï¼š
1. å…¨å±€å…‰ç…§ä¸å‡åŒ€ (shading variation)
2. Patchçº§ç‰¹å¾èƒ½æ•è·å±€éƒ¨å…‰ç…§å·®å¼‚
3. MaxPool + AvgPool ç»„åˆï¼š
   - MaxPool: æ•è·å±€éƒ¨äº®åº¦å³°å€¼
   - AvgPool: æ•è·å¹³å‡è¶‹åŠ¿
4. ç»“åˆæ›´å¥å£®
```

### ä¸ºä»€ä¹ˆ PWCNet å¾ˆå…³é”®ï¼Ÿ
```
åŸå› ï¼š
1. ä¸¤ä¸ªç›¸æœºçš„å›¾åƒè™½æ˜¯åŒä¸€åœºæ™¯ï¼Œä½†æœ‰è§†è§’å·®å¼‚
2. å•è‰²HSR (960Ã—1280) éœ€å¯¹é½åˆ°å½©è‰²LSR (480Ã—640)
3. PWCNet çš„å¤šå±‚çº§ç‰¹å¾åŒ¹é…èƒ½å¤„ç† 2å€ä¸‹é‡‡æ ·
4. é‡‘å­—å¡”ç»“æ„ + ç›¸å…³æ€§å±‚ = é«˜ç²¾åº¦å…‰æµ
```

### ä¸ºä»€ä¹ˆä¸‰ä¸ªæ¨¡å—å¿…é¡»è”åˆï¼Ÿ
```
åŸå› ï¼š
1. RefIE å¢å¼ºäº®åº¦ â†’ æä¾›æ›´å¥½çš„åˆå€¼ç»™ RefAT
2. RefAT èåˆçº¹ç† â†’ ä¸°å¯Œç»†èŠ‚ä¾› RefSR å‚è€ƒ
3. RefSR è¶…åˆ†è‰²åº¦ â†’ åˆ©ç”¨ RefAT çš„ç¨³å®šè¾“å‡º
4. ç«¯åˆ°ç«¯å¾®è°ƒ â†’ ååŒä¼˜åŒ–ï¼Œé¿å…è¯¯å·®ç´¯ç§¯
```

---

## ğŸ“‹ ä»£ç æŸ¥è¯¢é€Ÿè®°

### å¿«é€ŸæŸ¥æ‰¾ä»£ç ç‰‡æ®µ

| åŠŸèƒ½ | æ–‡ä»¶ | å‡½æ•°/ç±» | è¡Œå·èŒƒå›´ |
|------|------|--------|---------|
| RGBâ†’YUVè½¬æ¢ | image_utils.py | `rgb2yuv` class | ~5-30 |
| Patchç‰¹å¾æå– | ref_exposure_combine_clean.py | `ScaleYUVBlock` | ~68-98 |
| æ©ç èåˆ | test_flow_sample_refine_res_clean.py | `DecomNet_attention.forward` | ~77-93 |
| åŒè¾¹ç½‘æ ¼ | ref_SR_deshape_clean.py | `HDRNetwoBN.forward` | ~188-250 |
| è‰²åº¦å¾®è°ƒ | ref_SR_deshape_clean.py | `adjustChrome` | ~143-155 |
| å…‰æµè®¡ç®— | PWCNet.py | `PWCDCNet.forward` | ~134-280 |
| å›¾åƒå˜å½¢ | test-3ref-clean.py | `warp` function | ~27-55 |
| æŸå¤±è®¡ç®— | myLoss.py | `YUV_Loss.forward` | ~24-31 |
| æ•°æ®åŠ è½½ | loadDataset.py | `myBilateralDataset` | ~260-330 |

---

## ğŸ” éªŒè¯æ£€æŸ¥æ¸…å•

âœ… **RefIE æ¨¡å—**:
- [ ] ScaleYUVBlock çš„ 9Ã—9 æ ¸ âœ“
- [ ] MaxPool + AvgPool é‡‘å­—å¡” âœ“
- [ ] 5å±‚ BasicBlock æ®‹å·® âœ“
- [ ] Tanh æ¿€æ´» âœ“

âœ… **RefAT æ¨¡å—**:
- [ ] PWCNet å…‰æµè®¡ç®— âœ“
- [ ] warp å‡½æ•°çš„ grid_sample âœ“
- [ ] 7é€šé“æ‹¼æ¥ [RGB, warped, mono] âœ“
- [ ] Sigmoid æ©ç å½’ä¸€åŒ– âœ“
- [ ] æ©ç åŠ æƒèåˆ âœ“

âœ… **RefSR æ¨¡å—**:
- [ ] 4å±‚ Splat ä¸‹é‡‡æ · âœ“
- [ ] å…¨å±€åˆ†æ”¯å¤šå±‚çº§AAP âœ“
- [ ] 96ç»´åŒè¾¹ç½‘æ ¼ âœ“
- [ ] Guide2 çš„ Tanh âœ“
- [ ] è‰²åº¦å¾®è°ƒç½‘ç»œ âœ“

âœ… **å…³é”®æŠ€æœ¯**:
- [ ] GPU/CPU è‡ªåŠ¨é™çº§ âœ“
- [ ] YUV è‰²å½©ç©ºé—´ âœ“
- [ ] Patch-wise ç‰¹å¾ âœ“
- [ ] å…‰æµå¯¹é½ âœ“
- [ ] åˆ†é˜¶æ®µæŸå¤± âœ“
